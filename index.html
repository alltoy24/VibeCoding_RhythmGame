<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>WEB BEAT : SELECT</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Roboto:wght@400;700&display=swap');
        body { margin: 0; background: #050505; color: #fff; font-family: 'Roboto', sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; user-select: none; }
        
        header { text-align: center; margin-top: 30px; animation: float 3s infinite ease-in-out; }
        h1 { font-family: 'Orbitron'; font-size: 60px; margin: 0; color: #00e5ff; text-shadow: 0 0 20px rgba(0,229,255,0.5); }
        
        /* ë¡œë”©/ì—ëŸ¬ ë©”ì‹œì§€ìš© */
        .status-msg { margin-top: 100px; font-size: 20px; color: #888; font-family: 'Orbitron'; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        .song-container { display: flex; gap: 30px; padding: 20px 50px; overflow-x: auto; width: 90%; height: 550px; align-items: center; scroll-behavior: smooth; margin-top: 20px; }
        .song-container::-webkit-scrollbar { height: 10px; }
        .song-container::-webkit-scrollbar-thumb { background: #333; border-radius: 5px; }
        
        .song-card { min-width: 340px; height: 460px; background: #1a1a1a; border: 2px solid #333; border-radius: 15px; padding: 20px; display: flex; flex-direction: column; transition: 0.3s; position: relative; }
        .song-card:hover { transform: translateY(-10px); border-color: #00e5ff; box-shadow: 0 0 30px rgba(0,229,255,0.2); }
        
        .card-cover { width: 100%; height: 160px; background: #000; display: flex; align-items: center; justify-content: center; font-size: 60px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #444; color: #333; }
        .card-title { font-family: 'Orbitron'; font-size: 24px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 5px; color: #fff; }
        .card-artist { color: #888; font-size: 14px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        
        .diff-box { margin-top: auto; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; max-height: 180px; padding-right: 5px; }
        .diff-box::-webkit-scrollbar { width: 5px; }
        .diff-box::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }

        .btn-diff { 
            width: 100%; padding: 12px 15px; border: none; border-radius: 8px; cursor: pointer; 
            font-weight: bold; text-transform: uppercase; transition: 0.2s; 
            display: flex; justify-content: space-between; align-items: center;
            font-family: 'Orbitron', sans-serif; box-sizing: border-box;
        }
        .btn-diff:hover { transform: scale(1.02); filter: brightness(1.2); }
        
        .btn-diff.normal { background: linear-gradient(90deg, #00c6ff, #0072ff); color: #fff; }
        .btn-diff.hard { background: linear-gradient(90deg, #ff00cc, #333399); color: #fff; }
        .btn-diff.troll { background: linear-gradient(90deg, #8E2DE2, #4A00E0); color: #fff; }

        .left-part { display: flex; align-items: center; gap: 8px; }
        .lv-badge { background: rgba(0,0,0,0.4); padding: 2px 6px; border-radius: 4px; font-size: 0.8em; color: #ffd700; }
        .score-badge { font-family: 'Roboto', sans-serif; font-size: 14px; background: rgba(0,0,0,0.5); padding: 4px 10px; border-radius: 6px; color: #fff; font-weight: bold; border: 1px solid rgba(255,255,255,0.2); }

        @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <header>
        <h1>ARCADE SELECT</h1>
        <div style="color:#666; letter-spacing:5px; font-size:14px;">CHOOSE YOUR STAGE</div>
    </header>

    <div class="song-container" id="song-list">
        <div class="status-msg">LOADING SONGS...</div>
    </div>

    <script>
        // í˜ì´ì§€ê°€ ì—´ë¦¬ìë§ˆì ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', async () => {
            const list = document.getElementById('song-list');
            
            try {
                // 1. song_list.json ì½ì–´ì˜¤ê¸° (ìë™)
                const response = await fetch('song_list.json');
                
                if (!response.ok) {
                    throw new Error("song_list.jsonì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }

                const songs = await response.json();
                list.innerHTML = ""; // ë¡œë”© ë©”ì‹œì§€ ì§€ìš°ê¸°

                // 2. ë°›ì•„ì˜¨ ë°ì´í„°ë¡œ ì¹´ë“œ ë§Œë“¤ê¸°
                songs.forEach(song => {
                    const diffs = [];

                    // ì°¨íŠ¸ íŒŒì¼ëª… ë¶„ì„
                    song.charts.forEach(filename => {
                        const lowerName = filename.toLowerCase();
                        let type = '';
                        if (lowerName.includes('normal')) type = 'normal';
                        else if (lowerName.includes('hard')) type = 'hard';
                        else if (lowerName.includes('troll')) type = 'troll';

                        if (type) {
                            const numMatch = filename.match(/_(\d+)\.json$/);
                            const level = numMatch ? numMatch[1] : null;
                            const fileKey = filename.replace(/\.json$/i, ''); // í™•ì¥ì ì œê±°

                            diffs.push({
                                type: type,
                                level: level ? parseInt(level) : 0,
                                levelRaw: level,
                                fileKey: fileKey
                            });
                        }
                    });

                    // ë‚œì´ë„ ì •ë ¬
                    const typeOrder = { 'normal': 1, 'hard': 2, 'troll': 3 };
                    diffs.sort((a, b) => {
                        if (typeOrder[a.type] !== typeOrder[b.type]) return typeOrder[a.type] - typeOrder[b.type];
                        return a.level - b.level;
                    });

                    // HTML ìƒì„±
                    const card = document.createElement('div');
                    card.className = 'song-card';
                    
                    let diffButtons = '';
                    diffs.forEach(d => {
                        const scoreKey = `wb_score_${song.folder}_${d.fileKey}`;
                        const savedScore = localStorage.getItem(scoreKey) || '000000';
                        const levelHtml = d.levelRaw ? `<span class="lv-badge">Lv.${d.levelRaw}</span>` : '';

                        diffButtons += `
                            <button class="btn-diff ${d.type}" onclick="play('${song.folder}', '${d.fileKey}')">
                                <div class="left-part">
                                    <span>${d.type.toUpperCase()}</span>
                                    ${levelHtml}
                                </div>
                                <span class="score-badge">ğŸ† ${savedScore}</span>
                            </button>`;
                    });

                    card.innerHTML = `
                        <div class="card-cover">ğŸµ</div>
                        <div class="card-title">${song.title}</div>
                        <div class="card-artist">${song.artist}</div>
                        <div class="diff-box">${diffButtons}</div>
                    `;
                    list.appendChild(card);
                });

            } catch (err) {
                console.error(err);
                list.innerHTML = `<div class="status-msg" style="color:#ff5555">
                    ERROR: song_list.jsonì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                    <span style="font-size:14px">íŒŒì¼ì´ ìˆëŠ”ì§€, í˜•ì‹ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</span>
                </div>`;
            }
        });

        function play(folder, fileKey) {
            // ì—”ì§„ìœ¼ë¡œ ì´ë™ (game_editor.htmlë¡œ ì´ë™í•˜ë„ë¡ ì„¤ì •ë¨)
            window.location.href = `game_editor.html?song=${encodeURIComponent(folder)}&diff=${fileKey}`;
        }
    </script>
</body>
</html>