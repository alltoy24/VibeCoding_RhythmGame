<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>TrollBeat V6: Select</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Roboto:wght@400;700&display=swap');
        body { margin: 0; background: #050505; color: #fff; font-family: 'Roboto', sans-serif; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; user-select: none; }
        
        header { text-align: center; margin-top: 30px; animation: float 3s infinite ease-in-out; width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; }
        h1 { font-family: 'Orbitron'; font-size: 60px; margin: 0; color: #00e5ff; text-shadow: 0 0 20px rgba(0,229,255,0.5); }
        
        /* Î∞∞ÏÜç Ï°∞Ï†à UI (Ï§ëÏïô) */
        .speed-control { 
            margin-top: 15px; 
            background: rgba(255, 255, 255, 0.1); 
            padding: 8px 25px; 
            border-radius: 30px; 
            border: 1px solid #333; 
            display: flex; align-items: center; gap: 15px; 
            backdrop-filter: blur(5px);
            width: fit-content;
        }
        .speed-label { font-family: 'Orbitron'; color: #00e5ff; font-size: 16px; font-weight: bold; }
        .speed-val { font-family: 'Orbitron'; color: #fff; font-size: 20px; min-width: 50px; text-align: right; }
        input[type="range"] { accent-color: #00e5ff; cursor: pointer; width: 150px; }

        /* ‚òÖ [Ï∂îÍ∞ÄÎê®] ÏóêÎîîÌÑ∞ Ïù¥Îèô Î≤ÑÌäº (Ïö∞Ï∏° ÏÉÅÎã® Íµ¨ÏÑù) */
        .btn-create { 
            position: absolute; top: 20px; right: 30px; 
            text-decoration: none; color: #666; font-family: 'Orbitron'; font-size: 12px; font-weight: bold;
            border: 1px solid #333; padding: 10px 20px; border-radius: 20px; transition: 0.3s;
            display: flex; align-items: center; gap: 5px;
        }
        .btn-create:hover { color: #00e5ff; border-color: #00e5ff; box-shadow: 0 0 15px rgba(0,229,255,0.2); }

        .status-msg { margin-top: 50px; font-size: 20px; color: #888; font-family: 'Orbitron'; animation: blink 1.5s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

        .song-container { display: flex; gap: 30px; padding: 20px 50px; overflow-x: auto; width: 90%; height: 550px; align-items: center; scroll-behavior: smooth; margin-top: 10px; }
        .song-container::-webkit-scrollbar { height: 10px; }
        .song-container::-webkit-scrollbar-thumb { background: #333; border-radius: 5px; }
        
        .song-card { min-width: 340px; height: 460px; background: #1a1a1a; border: 2px solid #333; border-radius: 15px; padding: 20px; display: flex; flex-direction: column; transition: 0.3s; position: relative; }
        .song-card:hover { transform: translateY(-10px); border-color: #00e5ff; box-shadow: 0 0 30px rgba(0,229,255,0.2); }
        
        .card-cover { width: 100%; height: 160px; background: #000; display: flex; align-items: center; justify-content: center; font-size: 60px; border-radius: 10px; margin-bottom: 15px; border: 1px solid #444; color: #333; }
        .card-title { font-family: 'Orbitron'; font-size: 24px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 5px; color: #fff; }
        .card-artist { color: #888; font-size: 14px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        
        .diff-box { margin-top: auto; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; max-height: 180px; padding-right: 5px; }
        .diff-box::-webkit-scrollbar { width: 5px; }
        .diff-box::-webkit-scrollbar-thumb { background: #555; border-radius: 3px; }

        .btn-diff { 
            width: 100%; padding: 12px 15px; border: none; border-radius: 8px; cursor: pointer; 
            font-weight: bold; text-transform: uppercase; transition: 0.2s; 
            display: flex; justify-content: space-between; align-items: center;
            font-family: 'Orbitron', sans-serif; box-sizing: border-box;
        }
        .btn-diff:hover { transform: scale(1.02); filter: brightness(1.2); }
        
        .btn-diff.normal { background: linear-gradient(90deg, #00c6ff, #0072ff); color: #fff; }
        .btn-diff.hard { background: linear-gradient(90deg, #ff00cc, #333399); color: #fff; }
        .btn-diff.troll { background: linear-gradient(90deg, #8E2DE2, #4A00E0); color: #fff; }

        .left-part { display: flex; align-items: center; gap: 8px; }
        .lv-badge { background: rgba(0,0,0,0.4); padding: 2px 6px; border-radius: 4px; font-size: 0.8em; color: #ffd700; }
        .score-badge { font-family: 'Roboto', sans-serif; font-size: 14px; background: rgba(0,0,0,0.5); padding: 4px 10px; border-radius: 6px; color: #fff; font-weight: bold; border: 1px solid rgba(255,255,255,0.2); }

        @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    </style>
</head>
<body>

    <a href="game_editor.html" class="btn-create">üõ† CREATE CHART</a>

    <header>
        <h1>TrollBeat V6</h1>
        <div style="color:#666; letter-spacing:5px; font-size:14px; margin-bottom: 5px;">CHOOSE YOUR SONG</div>
        
        <div class="speed-control">
            <span class="speed-label">NOTE SPEED</span>
            <input type="range" id="speed-slider" min="1.0" max="20.0" step="0.1" value="10.0">
            <span class="speed-val" id="speed-display">10.0</span>
        </div>
    </header>

    <div class="song-container" id="song-list">
        <div class="status-msg">LOADING SONGS...</div>
    </div>

    <script>
        const speedSlider = document.getElementById('speed-slider');
        const speedDisplay = document.getElementById('speed-display');

        const savedSpeed = localStorage.getItem('wb_user_speed');
        if (savedSpeed) {
            speedSlider.value = savedSpeed;
            speedDisplay.innerText = parseFloat(savedSpeed).toFixed(1);
        }

        speedSlider.addEventListener('input', (e) => {
            const val = parseFloat(e.target.value).toFixed(1);
            speedDisplay.innerText = val;
            localStorage.setItem('wb_user_speed', val);
        });

        window.addEventListener('DOMContentLoaded', async () => {
            const list = document.getElementById('song-list');
            try {
                const response = await fetch('song_list.json');
                if (!response.ok) throw new Error("song_list.jsonÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
                const songs = await response.json();
                list.innerHTML = ""; 

                songs.forEach(song => {
                    const diffs = [];
                    song.charts.forEach(filename => {
                        const lowerName = filename.toLowerCase();
                        let type = '';
                        if (lowerName.includes('normal')) type = 'normal';
                        else if (lowerName.includes('hard')) type = 'hard';
                        else if (lowerName.includes('troll')) type = 'troll';

                        if (type) {
                            const numMatch = filename.match(/_(\d+)\.json$/);
                            const level = numMatch ? numMatch[1] : null;
                            const fileKey = filename.replace(/\.json$/i, ''); 

                            diffs.push({
                                type: type,
                                level: level ? parseInt(level) : 0,
                                levelRaw: level,
                                fileKey: fileKey
                            });
                        }
                    });

                    const typeOrder = { 'normal': 1, 'hard': 2, 'troll': 3 };
                    diffs.sort((a, b) => {
                        if (typeOrder[a.type] !== typeOrder[b.type]) return typeOrder[a.type] - typeOrder[b.type];
                        return a.level - b.level;
                    });

                    const card = document.createElement('div');
                    card.className = 'song-card';
                    
                    let diffButtons = '';
                    diffs.forEach(d => {
                        const scoreKey = `wb_score_${song.folder}_${d.fileKey}`;
                        const savedScore = localStorage.getItem(scoreKey) || '000000';
                        const levelHtml = d.levelRaw ? `<span class="lv-badge">Lv.${d.levelRaw}</span>` : '';

                        diffButtons += `
                            <button class="btn-diff ${d.type}" onclick="play('${song.folder}', '${d.fileKey}')">
                                <div class="left-part">
                                    <span>${d.type.toUpperCase()}</span>
                                    ${levelHtml}
                                </div>
                                <span class="score-badge">üèÜ ${savedScore}</span>
                            </button>`;
                    });

                    card.innerHTML = `
                        <div class="card-cover">üéµ</div>
                        <div class="card-title">${song.title}</div>
                        <div class="card-artist">${song.artist}</div>
                        <div class="diff-box">${diffButtons}</div>
                    `;
                    list.appendChild(card);
                });

            } catch (err) {
                console.error(err);
                list.innerHTML = `<div class="status-msg" style="color:#ff5555">ERROR: song_list.json Error</div>`;
            }
        });

        function play(folder, fileKey) {
            const speed = speedSlider.value;
            window.location.href = `game_editor.html?song=${encodeURIComponent(folder)}&diff=${fileKey}&speed=${speed}`;
        }
    </script>
</body>
</html>